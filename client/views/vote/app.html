{% extends "vote_layout/layout_vote.html" %}
{% from "_formhelpers.html" import renderMessages %}

{% block body %}
{{ renderMessages() }}


<section class="main-content vote">
    <div id="app_container">

    </div>
</section>


{% raw %}

<script type="text/x-handlebars"  data-template-name="star">
[{{view.vote}}]
</script>

<script type="text/x-handlebars"  data-template-name="votecontrols">
    {{view "star" band=view.band vote=1}}
    {{view "star" band=view.band vote=2}}
    {{view "star" band=view.band vote=3}}
    {{view "star" band=view.band vote=4}}
    {{view "star" band=view.band vote=5}}
</script>

</script><script type="text/x-handlebars" id="main">
    <div class="main-area">

        <div class="sidebar-area player">
            {{#if current }}
            {{#link-to "band" current.band.id }}
            <div style="width: 200px; height: 200px; display: inline-block; margin: 10px; position: relative;" class="player">
                <image {{ bind-attr src=current.band.thumbnail }} />
                <div style="background-color: rgba(0,0,0, .5); width: 100%; position: absolute; bottom: 0; padding: 5px; text-align: center;">
                    {{ current.band.name }} ( {{ current.band.ownVote }})
                </div>
            </div>
            {{/link-to}}
            
            <br> Vote
                {{view "votecontrols" band=current.band }}
            ( {{ current.band.ownVote }})
            {{else }}
            <div style="height: 240px;"><!-- or do something else here if theres no track playing --></div>

            {{/if}}
            <audio {{bind-attr src=current.url }} id="tunefishPlayer"></audio>
            <div id="playCtrls" {{bind-attr class="playerState"}} >
                <a href="#" {{action "pause"}}>pause</a> ({{currentTime}} / {{currentDuration}})
            </div>
            <div id="idleCtrls" {{bind-attr class="playerState"}} >
                <a href="#" {{action "play"}}>play</a>
            </div>


            <a href="#" {{action "prev"}}>prev</a>
            <a href="#" {{action "next"}}>next</a>
            <a href="#" {{action "clear"}}>clear</a>
            <a href="#" {{action "shuffle"}}>shuffle</a>
            <br />
            <a href="#" {{ action "addUnvotedTracks" }}>Add all unvoted bands to queue</a>

            <div id="" style="overflow-y: scroll; height:200px;">
                <ul>
                    {{#each item in tracks}}
                    {{#view "queueitem" item=item }}
                    <a href="#" {{action "jumpTo" item.index }}>{{ item.track.trackname }}</a>
                    by {{#link-to "band" item.track.band.id }}{{ item.track.band.name }} {{/link-to}}
                    {{/view}}
                    {{/each}}
                </ul>
            </div>

        </div>

        {{ outlet }}
    </div>
</script>

<script type="text/x-handlebars" id="bands">
    {{#view "bandgrid" id="band-list"}}

        {{#each band in this}}

        {{#link-to "band" band.id classNames="band-tile" data-sort=band.name data-voted=band.own_vote}}
        <div class="band-tile-content">
            {{#if band.voted}}<i class="i-done band-voted"></i>{{/if}}
            <img class="band-tile-img" src="{{unbound band.thumbnail}}" alt="{{unbound band.name}}"/>
            <div class="band-tile-desc">
                {{ band.name }} ({{ band.ownVote }})
            </div>
        </div>
        {{/link-to}}

        {{/each}}
        <div class="band-grid-gap"></div>

    {{/view}}
</script>

<script type="text/x-handlebars" id="band">

    <div id="band-detail" class="content-area band-detail">
        <div class="breadcrumb">{{#link-to 'bands' }}Bands{{/link-to}} / "{{ name }}"</div>

        {{view "votecontrols" band=this }}

        <div class="row">
            <h3>Mitglieder</h3>
            <div>{{members}}</div>
        </div>

        <div class="row">
            <h3>Herkunft</h3>
            <div>{{city}}</div>
            <img src="http://maps.googleapis.com/maps/api/staticmap?key=AIzaSyDRzrscCqKGd66mLS6jOayfUw9d4SICKOY&markers={{ unbound city }}&zoom=10&size=600x300&sensor=false"/>
            <button {{ action "calcDistance" }} id="calcDist">Entfernung berechnen</button>
        </div>

        <table style="width: 100%;">
            <tbody>
            <tr>
                <td>Mitglieder:</td>
                <td>{{ members }}</td>
            </tr>
            <tr>
                <td>Herkunft:</td>
                <td>{{ city }}<br/>
                    <img src="http://maps.googleapis.com/maps/api/staticmap?key=AIzaSyDRzrscCqKGd66mLS6jOayfUw9d4SICKOY&markers={{ unbound city }}&zoom=10&size=600x300&sensor=false"/>
                    <button {{ action "calcDistance" }} id="calcDist">Entfernung berechnen</button>
                </td>
            </tr>
            <tr>
                <td>Webseite:</td>
                <td><a {{bind-attr href=website }}>{{ website }}</a>
                    {{#if facebookUrl }},
                    <a {{ bind-attr href=facebookUrl }}>facebook</a>
                    {{/if }}
                </td>
            </tr>
            {{#if youtube_url }}
            <tr>
                <td>YouTube:</td>
                <td>
                    <!-- Feel free to use some JS hacks to avoid this iframe, Dennis -->
                    <iframe id="ytplayer" type="text/html" width="640" height="390"
                            {{ bind-attr src=youtubeUrl }}"
                    frameborder="0"/>
                </td>
            </tr>
            {{/if }}

            <tr>
                <td>Beschreibung:</td>
                <td>{{ descp }}</td>
            </tr>
            </tbody>
        </table>

        <h3>Tracks</h3>     <a href="#" {{ action "addAllTracks" }}>Add all tracks to queue</a>
        <ul>
            {{#each track in tracks }}
            <li ><a href="#" {{ action "addTrack" track }}>
                {{ track.trackname }}
                </a>
            </li>
            {{/each}}
        </ul>

        <h3>Bandfoto</h3>
        <img {{bind-attr src=image }} width="100%"/>

        <h3>Kommentare</h3>
        <table style="width: 100%;">
            <tbody>
            {{#each comment in comments }}
            <tr>
                <td>{{ comment.author }} <br> {{ comment.timestamp }}</td>
                <td>{{ comment.message }}</td>
            </tr>
            {{/each}}

            </tbody>
        </table>
        <h3>Dein Kommentar:</h3>
        <form {{action "addComment" on="submit"}}>

        {{ textarea name="comment" value=comment id="new_comment" required="required" }}

        <button type="submit">Add</button>

        </form>
    </div>

</script>
{% endraw %}


{% endblock %}
