{% extends "vote_layout/layout_vote.html" %}
{% from "_formhelpers.html" import renderMessages %}

{% block body %}

<div id="messages" class="message-container">
    {{ renderMessages() }}
</div>

<section class="main-content profile finish">
    <div class="row">
        <div class="profile-form-wrapper col-xs-12">
            <div class="form-action" id="step-finish">
                <div class="step-content">
                    <a href="{{ url_for('vote.admin.index') }}">Administration</a> / Bands

                    <h2>Band√ºbersicht</h2>

                    {% set sort = request.args.sort|default('name') %}
                    {% set reverse = request.args.reverse|default(0)|int %}

                    {% macro build_sort_url(field, reverse) %}{{url_for('vote.admin.bands.list')}}?sort={{ field }}{% if reverse == 0 %}&amp;reverse=1{% endif %}{% endmacro %}

                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th><a href="{{ build_sort_url('name', reverse) }}">Band</a></th>
                                <th><a href="{{ build_sort_url('amount_members', reverse) }}">Mitgl.</a></th>
                                <th><a href="{{ build_sort_url('city', reverse) }}">Herkunft</a></th>
                                <th><a href="{{ build_sort_url('state', reverse) }}">Status</a></th>
                                <th>
                                    <a href="{{ build_sort_url('vote_count', reverse) }}">Voting</a>,
                                    <a href="{{ build_sort_url('vote_average', reverse) }}">&#8960;</a>
                                </th>
                                <th colspan="3">Optionen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for band in bands|sort(attribute=sort, reverse=reverse) %}
                            <tr>
                                <td><a href="{{ url_for('vote.admin.bands.view', band_id=band.id) }}">{{ band.name }}</a></td>
                                <td>{% if band.amount_members != "NULL" %}{{ band.amount_members }}{% else %}?{% endif %}</td>
                                <td>{% if band.city != "NULL" %}{{ band.city }}{% else %}?{% endif %}</td>
                                <td>{{ band.state_label }}</td>
                                <td>{{ band.vote_count }}, &#8960; {{ band.vote_average }}</td>
                                <td>Edit</td>
                                <td>X</td>
                                <td>{% if band.state == 1 %}
                                        <a href="{{ url_for('vote.admin.bands.vote_state', band_id=band.id) }}">- Voting</a>
                                    {% elif band.state == 2 %}
                                        <a href="{{ url_for('vote.admin.bands.vote_state', band_id=band.id) }}">+ Voting</a>
                                    {% else %}
                                        [---]
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}
